---
title: "Easy R Markdown Reporting with {chronicle}"
author: "Philippe Heymans Smith - @pheymanss"
output:
  xaringan::moon_reader:
    css: [useR, useR-fonts]
    lib_dir: libs
    nature:
      ratio: '16:9'
      slideNumberFormat: '%current%' 
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r, echo=FALSE}
options(knitr.duplicate.label = "allow")
xaringanExtra::use_tile_view()
xaringanExtra::use_webcam()
```

## chronicle
An opinionated assistant that makes R Markdown reports for you.

--

```{r, message=FALSE}
library(chronicle)

demo_report <-
  add_table(table = head(iris),
            table_title = "A glimpse at the iris dataset",
            html_table_type = "kable") %>%
  add_raincloud(dt = iris,
                value = "Sepal.Length",
                groups = "Species") %>% 
  add_text(text = c('Add text between elements like these!',
                    stringi::stri_rand_lipsum(1))) %>%
  add_boxplot(dt = palmerpenguins::penguins, 
              value = 'body_mass_g',
              groups = 'island',
              split_groups_by = 'sex')
```

--

```{r, message=FALSE, warning=FALSE, eval=TRUE}
render_report(demo_report)
```

---

### supported elements

- Bar plots
- Box plots
- Code chunks
- Density plots
- dygraphs
- Histograms
- Images
- Line plots
- Plain tex
- Raincloud plots
- Scatter plots
- Tables (kable and DT.js)
- Violin plots

---

```{r, message=FALSE, warning=FALSE, eval=FALSE}
demo_report
```

--


```{r, message=FALSE, warning=FALSE, echo=FALSE, fig.alt='The variable demo_report reveals itself to be a character string containing all the usual content you would expect looking at the content of an R Markdown file: backticks and brackets opening and closing R code chunks, numeral symbols specifying headers, and plain text inbetween code chunks.'}
knitr::include_graphics('demo_report.png', dpi = 250)
```

---
.pull-left[
### chronicle
```{r, message=FALSE, eval=FALSE}
demo_report <-
  add_table(...) %>%
  add_raincloud(...) %>% 
  add_text(...) %>%
  add_boxplot(...)
```
]

.pull-right[
### R Markdown
```{r, message=FALSE, warning=FALSE, echo=FALSE, fig.alt='The same printing of the demo report, showing how it contains the text of an R Markdown report corresponding to the elements specified through the add_ family of functions.'}
knitr::include_graphics('demo_report.png', dpi = 250, )
```
]


---

```{css, echo=FALSE}
.code{
  background-color: #f8f8f8;
    color: black;
}
```



## .code[make] family of functions

```{r, echo=TRUE, message=FALSE, warning=FALSE, eval=FALSE, fig.alt='An html widget embedded into the presentation, containing three separated groups of interactive boxplots, one group for each species. Inside each group, there are three box plots, one for female, male and NA sex values.'}
chronicle::make_boxplot(dt = palmerpenguins::penguins,
                        value = 'body_mass_g',
                        groups = 'island',
                        split_groups_by = 'sex',
                        jitter = TRUE,
                        plot_palette_generator = 'viridis',
                        static = FALSE)
```

--

```{r, warning=FALSE, echo=FALSE}
widgetframe::frameWidget(chronicle::make_boxplot(dt = palmerpenguins::penguins,
                                                 value = 'body_mass_g',
                                                 groups = 'island',
                                                 split_groups_by = 'sex',
                                                 jitter = TRUE,
                                                 plot_palette_generator = 'viridis',
                                                 static = FALSE),
                         width = '100%', 
                         height = 270)
```

---

class: chapter-slide

# but please do learn ggplot2!

---

### Rendering
```{r, eval=FALSE, message=FALSE, warning=FALSE}
render_report(report = director_report, 
              output_format = 'word_document',
              title = 'Director report',
              filename = 'director_obs', 
              docx_reference_file = 'institution_template.docx')
```
--
```{r, eval=FALSE, message=FALSE, warning=FALSE}
render_report(report = niche_report, 
              output_format = 'pagedown',
              filename = 'Niche Team')
```
--
```{r, eval=FALSE, message=FALSE, warning=FALSE}
render_report(report = lab_report, 
              output_format = c('rmdformats','pdf')
              title = paste('Lab Observations', Sys.Date()), 
              filename = paste('lab_observations', Sys.Date()))
```
--
Careful! Being messy is bad!
---

### Rendering

.code[render_report()] lets you customize:

- File name (default is a generic name with date)
--

- Title and author
--

- Include date
--

- Directory for the output
--

- Output format (several at a time)
--

- Keep the .Rmd file it wrote
--

- Render the report or not
--

- Include table of contents (when formats allow it)
--

- Table of content depth
--

- Number the sections
--

- Figure width and height
--

- Plot pallete
--

- Plot palette generator (viridis)
--

- Themes
  - html_theme
  - rmdformats
  - prettydoc
  - Microsoft Word and PowerPoint reference files
--

- Experimental but for you: custom output YAML specifications

---
## Output formats
.pull-left[
### Interactive
-   bookdown
-   github_document
-   html_document
-   html_notebook
-   ioslides
-   prettydoc
-   rmdformats (default)
-   slidy_presentation
-   tufte_html
]

.pull-right[
### Static
-   pagedown
-   pdf
-   powerpoint_presentation
-   rolldown
-   tufte_handout
-   word_document
]
---

## YAML header

.pull-left[
```{r, message=FALSE, warning=FALSE, echo=TRUE, eval=FALSE}
output_config('rmdformats')
```

```{r, message=FALSE, warning=FALSE, echo=FALSE, fig.alt='The YAML header corresponding to the configuration of an RMD Formats output. The key point in here is that the global parameter ste_static is equal to FALSE, since this output can support dynamic html widgets'}
knitr::include_graphics('output_rmdformats.png', dpi = 150)
```
]

.pull-right[
```{r, message=FALSE, warning=FALSE, echo=TRUE, eval=FALSE, fig.alt='The YAML header corresponding to the configuration of a Word document output. The key point in here is that the global parameter ste_static is equal to TRUE, since this output cannot support dynamic html widgets'}
output_config('word_document',
              docx_reference_file = 'lab_template.docx')
```

```{r, message=FALSE, warning=FALSE, echo=FALSE}
knitr::include_graphics('output_word.png', dpi = 150)
```
]

---

## report_columns()
```{r, eval=TRUE, message=FALSE, warning=FALSE}
report_columns(palmerpenguins::penguins)
```

--
```{r, eval=TRUE, message=FALSE, warning=FALSE}
report_columns(palmerpenguins::penguins, 
               by_column = 'species')
```

---

## Limitations

--

1. Plotly's limitations 
--
(my ignorance of plotly solutions?)
--

  - Compatibility of custom geoms.
--

  - Data sizes translate to report file sizes. 
--

      - If over 10,000 rows, it rolls back into static ggplot2
--
(ugly line on the sand, sorry)
--

2. Unsupported formats:
--

  - xaringan
--

  - flexdashboard
--

  - rticles 
--
(please don't)
--

3. Anything that is not currently supported
--
: .code[add_code()]

--

```{r eval=FALSE}
add_code(code = 'corrplot::corrplot(cor(mtcars))', eval = TRUE)
```

--

```{r echo=FALSE}
add_code(code = 'corrplot::corrplot(cor(mtcars))', eval = TRUE)
```

---

## Thank you!

github.com/pheymanss/chronicle

@pheymanss